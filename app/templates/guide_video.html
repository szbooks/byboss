{% extends 'layout/base.html' %}

{% block content %}
    <div class="content-area">
        <!-- 顶部操作栏 -->
        <div class="d-flex align-items-center flex-wrap mb-3">
            <!-- 操作按钮 -->
            <a href="{{ url_for('main.add_guide_video') }}" class="btn btn-primary me-2 mb-2">添加视频</a>
            <!-- 查询表单 -->
            <form action="{{ url_for('main.guide_video') }}" method="get" class="d-flex align-items-center mb-2 flex-grow-0">

                <input type="text" class="input-group-text me-2" name="video_name_search" placeholder="名称关键字,模糊查询" value="{{ request.args.get('video_name_search', '') }}">
                <button type="submit" class="btn btn-outline-primary">查询</button>
            </form>

        </div>
        <table class="table table-striped table-bordered table-light table-hover">
            <thead>
            <tr>
                <th>类型</th>
                <th>视频名称</th>
                <th>链接地址</th>
                <th>备注</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            {% for result  in results %}
                <tr>
                    <td>
                        {% if result.type == '1' %}
                            <span class="status-pending">对内</span>
                        {% elif result.type == '2' %}
                            对外
                        {% else %}
                            {{ "" }}
                        {% endif %}
                    </td>
                    <td style="max-width: 150px; position: relative; text-align: left;">
                        <span class="show-more" style="cursor: pointer;">
                            <span class="wrap-ellipsis" data-full-content="{{ result.video_name }}" data-field="video_name" title="点击可复制">{% if result.video_name %}
                                {{ result.video_name }}{% else %}{{ "" }}{% endif %}</span> <!-- Unicode for "Loading" icon -->
                            <span class="glyphicon glyphicon-triangle-bottom"></span>
                        </span>
                    </td>

                    <td style="max-width: 150px;position: relative; text-align: left; word-wrap: break-word; white-space: normal;">
    <span class="show-more" style="cursor: pointer; display: inline-block; width: 100%;">
        <span class="wrap-ellipsis"
              data-full-content="{{ result.video_address }}"
              data-field="video_address"
              title="点击可复制">
            {% if result.video_address %}
                {{ result.video_address }}
            {% else %}
                &nbsp;
            {% endif %}
        </span>
        <span class="glyphicon glyphicon-triangle-bottom"></span>
    </span>

                    <td style="max-width: 150px; position: relative;">
                        <span class="show-more" style="cursor: pointer;">
                            <span class="wrap-ellipsis" data-full-content="{{ result.remark }}" data-field="video_remark" title="点击可复制">{% if result.remark %}{{ result.remark }}{% else %}
                                {{ "" }}{% endif %}</span> <!-- Unicode for "Loading" icon -->
                            <span class="glyphicon glyphicon-triangle-bottom"></span>
                        </span>
                    </td>

                    <td style="max-width: 50px;">
                        <a href="{{ url_for('main.do_guide_video', id=result.id) }}" class="text-link">编辑</a>
                    </td>
                    {##}
                    {#                    <td>#}
                    {##}
                    {#                                <a href="{{ url_for('main.do_vip_refund', id=result.id) }}" class="text-link">处理</a>#}
                    {#
{#                    </td>#}
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <!-- 底部分页控件 -->
        <nav aria-label="Page navigation" class="d-flex justify-content-end pagination-container">
            <ul class="pagination pagination-sm">
                <li class="page-item {% if page <= 1 %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('main.guide_video', page=page-1) }}">上一页</a>
                </li>
                {% for num in range(1, total_pages + 1) %}
                    <li class="page-item {% if num == page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('main.guide_video', page=num) }}">{{ num }}</a>
                    </li>
                {% endfor %}
                <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('main.guide_video', page=page+1) }}">下一页</a>
                </li>
            </ul>
        </nav>
    </div>
    <script>
        $(document).ready(function () {
            $('[data-bs-toggle="tooltip"]').tooltip();
        });

        $('.show-more').click(function (e) {
            e.preventDefault(); // 阻止默认点击行为

            // 找到包含完整内容的span元素
            var fullContentSpan = $(this).find('.wrap-ellipsis');

            // 从data-full-content属性中获取完整内容
            var textToCopy = fullContentSpan.data('full-content');

            // 创建一个临时的textarea元素来复制文本
            var textarea = document.createElement("textarea");
            textarea.value = textToCopy;
            document.body.appendChild(textarea);
            textarea.select();

            // 尝试复制文本到剪贴板
            try {
                var successful = document.execCommand('copy');
                var msg = successful ? '成功' : '失败';
                console.log('文本复制: ' + msg);
                showCopySuccessToast();
                // 可选：显示一些用户反馈
                {#alert('内容已复制!');#}{##}
            } catch (err) {
                console.error('复制文本时出错:', err);
                alert('复制失败，请尝试手动复制。');
            }

            // 移除临时的textarea元素
            document.body.removeChild(textarea);
        });

        function showCopySuccessToast() {
            var toastDiv = document.createElement('div');
            toastDiv.textContent = '数据已复制到剪贴板';
            toastDiv.style.position = 'fixed';
            toastDiv.style.top = '10%';
            toastDiv.style.left = '50%';
            toastDiv.style.transform = 'translateX(-50%)';
            toastDiv.style.backgroundColor = '#f8d7da';
            toastDiv.style.color = '#721c24';
            toastDiv.style.padding = '10px';
            toastDiv.style.borderRadius = '5px';
            toastDiv.style.zIndex = '1000';
            toastDiv.style.minWidth = '250px';
            toastDiv.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
            document.body.appendChild(toastDiv);

            // 移除提示信息
            setTimeout(function () {
                document.body.removeChild(toastDiv);
            }, 2000);
        }


    </script>
    <style>
        .text-danger {
            color: #dc6a35; /* 或其他您希望的颜色 */
            margin-left: 15px; /* 添加左侧间距 */
        }

        .wrap-text {
            display: block;
            white-space: normal;
            word-wrap: break-word;
        }

        /* 完整内容样式 */
        .full-content {
            white-space: pre-wrap; /* 保留换行符 */
            background-color: #f9f9f9;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }


    </style>
{% endblock %}
