{% extends 'layout/base.html' %}

{% block content %}
    <div class="content-area">
        <!-- 顶部操作栏 -->
        <div class="d-flex align-items-center flex-wrap mb-3">
            <!-- 操作按钮 -->
            <a href="{{ url_for('main.add_coop_ex') }}" class="btn btn-primary me-2 mb-2">添加合作伙伴</a>
            <!-- 查询表单 -->
                        <form action="{{ url_for('main.coop_ex') }}" method="get" class="d-flex align-items-center mb-2 flex-grow-0">
                            <input type="text" class="input-group-text me-2" name="partner" placeholder="合作伙伴" value="{{ request.args.get('partner', '') }}">
                            <input type="text" class="input-group-text me-2" name="code" placeholder="邀请码" value="{{ request.args.get('code', '') }}">
                            <button type="submit" class="btn btn-outline-primary">查询</button>
                        </form>

        </div>
        <table class="table table-striped table-bordered table-light table-hover">
            <thead>
            <tr>
                <th>合作伙伴</th>
                <th>联系方式</th>
                <th>微信id</th>
                <th>合作区域</th>
                <th>推广邀请码</th>
                <th>邀请数/已赠送数</th>
                <th>邀请公司</th>
                <th>未付费</th>
                <th>异常（已支付未赠送）</th>
                <th>获得推广费/总付费</th>
                <th>备注</th>
                <th>创建时间</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            {% for result  in results %}
                <tr style="">
                    <td>{% if result.name %}{{ result.name }}{% else %}{{ "" }}{% endif %}</td>
                    <td>{% if result.phone %}{{ result.phone }}{% else %}{{ "" }}{% endif %}</td>
                    <td>{% if result.wx_id %}{{ result.wx_id }}{% else %}{{ "" }}{% endif %}</td>
                    <td>{% if result.area %}{{ result.area }}{% else %}{{ "" }}{% endif %}</td>
                    <td>{% if result.code %}{{ result.code }}{% else %}{{ "" }}{% endif %}</td>
                    <td style="max-width: 50px;">{% if result.num %}{{ result.num }}{% else %}{{ 0 }}{% endif %}/{% if result.pay_num %}{{ result.pay_num }}{% else %}{{ 0 }}{% endif %}</td>

{##}
{#                    <td style="max-width: 250px;">#}
{#                        <span class="wrap-ellipsis" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ result.companys }}">{{ result.companys|default('', true) }}</span>#}
{##}
{#                    </td>#}


                    <td style="max-width: 250px; position: relative;">
                        <span class="show-more" style="cursor: pointer;">
                            <span class="wrap-ellipsis" data-bs-toggle="tooltip" data-bs-placement="top" data-full-content="{{ result.companys }}" title="点击可复制">{{ result.companys|default('', true) }}</span>
                            <span class="glyphicon glyphicon-triangle-bottom"></span>
                        </span>
                    </td>




                     <td style="max-width: 250px; position: relative;">
                        <span class="show-more" style="cursor: pointer;">
                            <span class="wrap-ellipsis" data-bs-toggle="tooltip" data-bs-placement="top" data-full-content="{{ result.unpay }}" title="点击可复制">{{ result.unpay|default('', true) }}</span>
                            <span class="glyphicon glyphicon-triangle-bottom"></span>
                        </span>

                    </td>
{#                    <td style="max-width: 250px;">#}
{#                        <span class="wrap-ellipsis" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ result.unpay }}">{{ result.unpay |default('', true) }}</span>#}
{#                    </td>#}

                    <td style="max-width: 250px;">
                        <span class="wrap-ellipsis" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ result.ungive }}">{{ result.ungive |default('', true) }}</span>
                    </td>

                    <td>{% if result.promotion_fee %}{{ result.promotion_fee }}{% else %}{{ 0 }}{% endif %}/{% if result.original_price %}{{ result.original_price }}{% else %}{{ 0 }}{% endif %}</td>
                    <td>{% if result.remark %}{{ result.remark }}{% else %}{{ "" }}{% endif %}</td>
                    <td>{% if result.create_date %}{{ result.create_date }}{% else %}{{ "" }}{% endif %}</td>
                    <td>

                        <a href="{{ url_for('main.do_coop_ex', id=result.id) }}" class="text-link">编辑</a>

                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <!-- 底部分页控件 -->
        <nav aria-label="Page navigation" class="d-flex justify-content-end pagination-container">
            <ul class="pagination pagination-sm">
                <li class="page-item {% if page <= 1 %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('main.account_deletion', page=page-1) }}">上一页</a>
                </li>
                {% for num in range(1, total_pages + 1) %}
                    <li class="page-item {% if num == page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('main.account_deletion', page=num) }}">{{ num }}</a>
                    </li>
                {% endfor %}
                <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('main.account_deletion', page=page+1) }}">下一页</a>
                </li>
            </ul>
        </nav>
    </div>

<script>
$(document).ready(function() {
    $('.show-more').click(function(e) {
        e.preventDefault(); // 阻止默认点击行为

        // 找到包含完整内容的span元素
        var fullContentSpan = $(this).find('.wrap-ellipsis');

        // 从data-full-content属性中获取完整内容
        var textToCopy = fullContentSpan.data('full-content');

        // 创建一个临时的textarea元素来复制文本
        var textarea = document.createElement("textarea");
        textarea.value = textToCopy;
        document.body.appendChild(textarea);
        textarea.select();

        // 尝试复制文本到剪贴板
        try {
            var successful = document.execCommand('copy');
            var msg = successful ? '成功' : '失败';
            console.log('文本复制: ' + msg);
            showCopySuccessToast();
            // 可选：显示一些用户反馈
            {#alert('内容已复制!');#}
        } catch (err) {
            console.error('复制文本时出错:', err);
            alert('复制失败，请尝试手动复制。');
        }

        // 移除临时的textarea元素
        document.body.removeChild(textarea);
    });
    function showCopySuccessToast() {
                var toastDiv = document.createElement('div');
                toastDiv.textContent = '数据已复制到剪贴板';
                toastDiv.style.position = 'fixed';
                toastDiv.style.top = '10%';
                toastDiv.style.left = '50%';
                toastDiv.style.transform = 'translateX(-50%)';
                toastDiv.style.backgroundColor = '#f8d7da';
                toastDiv.style.color = '#721c24';
                toastDiv.style.padding = '10px';
                toastDiv.style.borderRadius = '5px';
                toastDiv.style.zIndex = '1000';
                toastDiv.style.minWidth = '250px';
                toastDiv.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
                document.body.appendChild(toastDiv);

                // 移除提示信息
                setTimeout(function () {
                    document.body.removeChild(toastDiv);
                }, 2000);
            }
});
</script>

    <style>


        /* 自定义单元格样式 */
        .wrap-ellipsis {
            display: -webkit-box;
            -webkit-line-clamp: 5; /* 显示的最大行数 */
            -webkit-box-orient: vertical;
            overflow: hidden;
        {#max-width: 250px;#} word-wrap: break-word; /* 允许单词断开换行 */
        }

        .full-content {
    display: none;
    position: absolute;
    top: 100%; /* 根据需要调整 */
    left: 0;
    background-color: white;
    border: 1px solid #ccc;
    z-index: 1000; /* 确保内容在顶部 */
    max-width: 400px;
    min-height: 200px;

    /* 其他样式，如宽度、边框、阴影等 */
}


    </style>
{% endblock %}
