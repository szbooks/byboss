{% extends 'layout/base.html' %}

{% block content %}
    <div class="content-area">
        <!-- 顶部操作栏 -->
        <div class="d-flex align-items-center flex-wrap mb-3">
            <!-- 查询表单 -->
            <form action="{{ url_for('main.sub_merchant_list') }}" method="get" class="d-flex align-items-center mb-2 flex-grow-0">
                <input type="text" class="input-group-text me-2" name="company_id" placeholder="输入公司ID" value="{{ request.args.get('company_id', '') }}">
                <select class="form-select me-2 search_channel" name="channel" id="channel">
                    <option value=''>通道</option>
                    <option value="wx" {% if status_filter['channel'] == 'wx' %}selected{% endif %}>微信</option>
                    <option value="Alipay" {% if status_filter['channel'] == 'Alipay' %}selected{% endif %}>支付宝</option>
                </select>


                <button type="submit" class="btn btn-outline-primary">查询</button>
            </form>

        </div>
        <p class="record_custom-margin">记录数: {{ total_count }} </p>
        <table class="table table-striped table-bordered table-light table-hover">
            <thead>
            <tr>
                <th>公司ID</th>
                <th>渠道</th>
                <th>商户名称</th>
                <th>商户号</th>
                <th>费率</th>
                <th>状态</th>
                <th>创建时间</th>
            </tr>
            </thead>
            <tbody>
            {% for result  in results %}
                <tr>
                    <td>
                        <a href="https://www.bypms.cn/admin/user/fakelogin?companyId={{ result.company_id }}" target="_blank">
                            {{ result.company_id }}
                        </a>
                    </td>
                    <td style="max-width: 100px;">{{ result.platform|default('', true) }}</td>
                    <td style="max-width: 50px;">{{ result.sub_mch_name|default('', true) }}</td>
                    <td style="max-width: 200px;">{{ result.sub_mch_id|default('', true) }}</td>
                    <td>{{ result.pay_channel_agent|default('', true) }}</td>
                    <td>
                        {% if result.state == "7" %}
                            已完成
                        {% elif result.state == "0" %}
                            待审核
                        {% else %}
                            {{ result.state|default('', true) }}
                        {% endif %}
                    </td>
                    <td>{{ result.create_time|default('', true) }}</td>
                    {#                    <td>#}
                    {#                        <a href="#" class="copyButton" data-app-id="{{ result.app_id }}" data-order-id="{{ result.app_secret }}" data-company_id="{{ result.granted_company_id }}">复制</a>#}
                    {#                        <a href="{{ url_for('main.do_api', id=result.id) }}" class="text-link">编辑</a>#}
                    {#                    </td>#}

                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <nav aria-label="Page navigation" class="d-flex justify-content-end pagination-container">
        <ul class="pagination pagination-sm">
            <!-- 上一页 -->
            <li class="page-item {% if page <= 1 %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('main.api_list', page=page-1) }}">上一页</a>
            </li>

            <!-- 首页 -->
            <li class="page-item {% if page == 1 %}active{% endif %}">
                <a class="page-link" href="{{ url_for('main.api_list', page=1) }}">1</a>
            </li>

            <!-- 省略号（如果当前页不在前几页） -->
            {% if start_page > 2 %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            {% endif %}

            <!-- 动态页码范围 -->
            {% for num in range(start_page, end_page + 1) %}
                <li class="page-item {% if num == page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('main.api_list', page=num) }}">{{ num }}</a>
                </li>
            {% endfor %}

            <!-- 省略号（如果当前页不在后几页） -->
            {% if end_page < total_pages - 1 %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            {% endif %}

            <!-- 末页 -->
            {% if total_pages > 1 %}
                <li class="page-item {% if page == total_pages %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('main.api_list', page=total_pages) }}">{{ total_pages }}</a>
                </li>
            {% endif %}

            <!-- 下一页 -->
            <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('main.api_list', page=page+1) }}">下一页</a>
            </li>
        </ul>
    </nav>


{% endblock %}
